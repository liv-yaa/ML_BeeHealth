{% extends 'base.html' %}
{% block content %}

{% if "user_id" in session %} 
<!-- for now!! -->
    

    <h3>{{ user.email }} is the user at this URL. ID#{{ user.user_id }}</h3>
    <br><br>

    <h2>Upload a photo! </h2>
    <form id="submit-form" action="/upload-success" enctype="multipart/form-data" method="POST" > 

        <br>
        <input type="file" name="file" id="file">

        <div>
          <label> How is the health of this bee?
            <input type="health" name="health" id="health" required>
          </label>
            <label> What is your zipcode?
              <input type="zipcode" name="zipcode" id="zipcode" required>
          </label>
        </div>
        
        <button type="submit" value="Submit Photo"> Submit Photo </button>
    </form>



    <div>
      <span id = "status" ></span>
      <!-- Link to gif -->
      <img src="" id="load"> 


    </div>


    <br><br>
    {% if user_bees %}

      <h2>All of Your Photos </h2>

      <ul>
      {% for photo in user_bees %}
        <li>
          <img src="{{ photo.url }}">

        </li>
      {% endfor %}
      </ul>

    {% else %}

      Users photos would have been here. None yet tho

    {% endif %}

  {% endif %}

    <script>
      $('#submit-form').on('submit', (evt) => {
        evt.preventDefault();

        $('#status').html('<i>Loading...</i>');
        $("#load").attr("src", "/static/images/load.gif");


        const formInputs = {
          'file': $('#file').val(),
          'health': $('#health').val(),
          'zipcode': $('#zipcode').val()

        };

        $.post('/upload-success', formInputs, (results) => {
          alert(results);

          // We know it is finished
          $('#status').html('');  // remove "loading" message

          $('#load').attr("src", "");

        });
      });


    </script>

    

{% endblock %}